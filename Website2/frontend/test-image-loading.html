<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Image Loading</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .image-test { margin: 10px 0; padding: 10px; border: 1px solid #eee; border-radius: 5px; }
        .image-test img { width: 200px; height: 200px; object-fit: cover; margin: 10px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        code { background: #f5f5f5; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç Test Image Loading</h1>
    
    <div class="test-section">
        <h3>Testing Uploaded Images</h3>
        <div id="uploaded-images"></div>
    </div>
    
    <div class="test-section">
        <h3>Testing External Images (Unsplash)</h3>
        <div id="external-images"></div>
    </div>

    <script src="api.js"></script>
    <script>
        async function testImages() {
            try {
                // Get products from API
                const data = await API.getProducts({ limit: 20 });
                const products = data.products;
                
                const uploadedDiv = document.getElementById('uploaded-images');
                const externalDiv = document.getElementById('external-images');
                
                let uploadedHTML = '';
                let externalHTML = '';
                
                products.forEach(product => {
                    const imageUrl = product.image_url;
                    let finalUrl;
                    let type;
                    
                    if (!imageUrl || imageUrl.trim() === '') {
                        return; // Skip products without images
                    }
                    
                    if (imageUrl.startsWith('http')) {
                        // External URL
                        finalUrl = imageUrl;
                        type = 'External (Unsplash)';
                        
                        externalHTML += `
                            <div class="image-test">
                                <strong>${product.name}</strong><br>
                                <code>${imageUrl}</code><br>
                                <img src="${finalUrl}" alt="${product.name}" 
                                     onload="this.nextElementSibling.innerHTML='<span class=success>‚úÖ Loaded</span>'"
                                     onerror="this.nextElementSibling.innerHTML='<span class=error>‚ùå Failed: ' + this.src + '</span>'">
                                <span>Loading...</span>
                            </div>
                        `;
                    } else {
                        // Uploaded image
                        finalUrl = `${API_BASE_URL.replace('/api', '')}${imageUrl}`;
                        type = 'Uploaded';
                        
                        uploadedHTML += `
                            <div class="image-test">
                                <strong>${product.name}</strong><br>
                                <strong>Raw URL:</strong> <code>${imageUrl}</code><br>
                                <strong>Full URL:</strong> <code>${finalUrl}</code><br>
                                <img src="${finalUrl}" alt="${product.name}" 
                                     onload="this.nextElementSibling.innerHTML='<span class=success>‚úÖ Loaded</span>'"
                                     onerror="this.nextElementSibling.innerHTML='<span class=error>‚ùå Failed</span>'; console.error('Failed to load:', this.src)">
                                <span>Loading...</span>
                            </div>
                        `;
                    }
                });
                
                uploadedDiv.innerHTML = uploadedHTML || '<p>No uploaded images found</p>';
                externalDiv.innerHTML = externalHTML || '<p>No external images found</p>';
                
            } catch (error) {
                console.error('Error:', error);
                document.body.innerHTML += `<p class="error">Error: ${error.message}</p>`;
            }
        }
        
        // Run test on page load
        testImages();
    </script>
</body>
</html>
